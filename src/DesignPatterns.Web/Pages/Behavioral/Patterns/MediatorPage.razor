@page "/behavioral/mediator"

<PageTitle>Mediator Pattern - Design Patterns</PageTitle>

<div class="max-w-7xl mx-auto px-4 py-8 md:py-12">
    <!-- Breadcrumb -->
    <Breadcrumb Items="@breadcrumbItems" />

    <!-- Header -->
    <div class="mb-12">
        <div class="flex items-center gap-3 md:gap-4 mb-4">
            <HeroIcon IconName="user-group" AdditionalClass="w-10 h-10 text-primary-600" />
            <div>
                <h1 class="text-4xl md:text-5xl font-bold text-secondary-900">Mediator Pattern</h1>
                <p class="text-secondary-600 text-lg mt-2">Patrón Comportamental</p>
            </div>
        </div>
        <p class="text-secondary-600 text-base md:text-lg max-w-3xl">
            Mediator define un objeto que encapsula cómo interactúan un conjunto de objetos. Promueve un
            acoplamiento débil al mantener los objetos de referencia entre sí indirectamente y permite variar
            sus interacciones independientemente.
        </p>
    </div>

    <!-- Main Content Grid -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-12">
        <!-- Left Column - Conceptual Content -->
        <div class="lg:col-span-2 space-y-8">
            <!-- ===== DEFINICIÓN ===== -->
            <div class="bg-white rounded-xl shadow-md p-6 md:p-8 border-l-4 border-primary-600">
                <div class="flex items-start gap-4 mb-4">
                    <HeroIcon IconName="light-bulb" AdditionalClass="w-6 h-6 text-primary-600 flex-shrink-0 mt-1" />
                    <div class="flex-1">
                        <h2 class="text-2xl font-bold text-secondary-900 mb-3">¿Qué es Mediator?</h2>
                        <p class="text-secondary-700 leading-relaxed">
                            Mediator es un patrón comportamental que centraliza la lógica de comunicación compleja
                            entre un conjunto de objetos (colegas). En lugar de que los objetos se comuniquen
                            directamente entre sí, se comunican a través de un mediador, reduciendo el acoplamiento
                            y facilitando el mantenimiento.
                        </p>
                    </div>
                </div>
            </div>

            <!-- ===== COMPONENTES CLAVE ===== -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Mediator -->
                <div class="bg-blue-50 rounded-xl shadow-md p-6 border-l-4 border-blue-500">
                    <div class="flex items-center gap-2 mb-4">
                        <HeroIcon IconName="squares-plus" AdditionalClass="w-6 h-6 text-blue-600" />
                        <h3 class="text-xl font-bold text-secondary-900">Mediator</h3>
                    </div>
                    <p class="text-secondary-700 text-sm leading-relaxed">
                        Define interfaz para comunicación. Coordina interacciones entre colegas.
                    </p>
                </div>

                <!-- Colleague -->
                <div class="bg-green-50 rounded-xl shadow-md p-6 border-l-4 border-accent-green">
                    <div class="flex items-center gap-2 mb-4">
                        <HeroIcon IconName="user" AdditionalClass="w-6 h-6 text-accent-green" />
                        <h3 class="text-xl font-bold text-secondary-900">Colleague</h3>
                    </div>
                    <p class="text-secondary-700 text-sm leading-relaxed">
                        Conoce su mediador. Se comunica solo a través del mediador, no directamente.
                    </p>
                </div>

                <!-- ConcreteMediator -->
                <div class="bg-yellow-50 rounded-xl shadow-md p-6 border-l-4 border-yellow-500">
                    <div class="flex items-center gap-2 mb-4">
                        <HeroIcon IconName="cog-6-tooth" AdditionalClass="w-6 h-6 text-yellow-600" />
                        <h3 class="text-xl font-bold text-secondary-900">ConcreteMediator</h3>
                    </div>
                    <p class="text-secondary-700 text-sm leading-relaxed">
                        Implementa lógica colaborativa. Coordina colegas concretos.
                    </p>
                </div>

                <!-- ConcreteColleague -->
                <div class="bg-purple-50 rounded-xl shadow-md p-6 border-l-4 border-purple-500">
                    <div class="flex items-center gap-2 mb-4">
                        <HeroIcon IconName="user-check" AdditionalClass="w-6 h-6 text-purple-600" />
                        <h3 class="text-xl font-bold text-secondary-900">ConcreteColleague</h3>
                    </div>
                    <p class="text-secondary-700 text-sm leading-relaxed">
                        Implementa lógica colaborativa. Se comunica vía mediador.
                    </p>
                </div>
            </div>

            <!-- ===== VENTAJAS Y DESVENTAJAS ===== -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Ventajas -->
                <div class="bg-green-50 rounded-xl shadow-md p-6 border-l-4 border-accent-green">
                    <div class="flex items-center gap-2 mb-4">
                        <HeroIcon IconName="check-circle" AdditionalClass="w-6 h-6 text-accent-green" />
                        <h3 class="text-xl font-bold text-secondary-900">Ventajas</h3>
                    </div>
                    <ul class="space-y-2 text-secondary-700">
                        <li class="flex items-start gap-2">
                            <HeroIcon IconName="arrow-right" AdditionalClass="w-4 h-4 text-accent-green flex-shrink-0 mt-1" />
                            <span>Desacoplamiento entre colegas</span>
                        </li>
                        <li class="flex items-start gap-2">
                            <HeroIcon IconName="arrow-right" AdditionalClass="w-4 h-4 text-accent-green flex-shrink-0 mt-1" />
                            <span>Centraliza control</span>
                        </li>
                        <li class="flex items-start gap-2">
                            <HeroIcon IconName="arrow-right" AdditionalClass="w-4 h-4 text-accent-green flex-shrink-0 mt-1" />
                            <span>Fácil cambiar interacciones</span>
                        </li>
                        <li class="flex items-start gap-2">
                            <HeroIcon IconName="arrow-right" AdditionalClass="w-4 h-4 text-accent-green flex-shrink-0 mt-1" />
                            <span>Componentes reutilizables</span>
                        </li>
                    </ul>
                </div>

                <!-- Desventajas -->
                <div class="bg-red-50 rounded-xl shadow-md p-6 border-l-4 border-red-500">
                    <div class="flex items-center gap-2 mb-4">
                        <HeroIcon IconName="exclamation-circle" AdditionalClass="w-6 h-6 text-red-600" />
                        <h3 class="text-xl font-bold text-secondary-900">Desventajas</h3>
                    </div>
                    <ul class="space-y-2 text-secondary-700">
                        <li class="flex items-start gap-2">
                            <HeroIcon IconName="arrow-right" AdditionalClass="w-4 h-4 text-red-600 flex-shrink-0 mt-1" />
                            <span>Mediator puede volverse complejo</span>
                        </li>
                        <li class="flex items-start gap-2">
                            <HeroIcon IconName="arrow-right" AdditionalClass="w-4 h-4 text-red-600 flex-shrink-0 mt-1" />
                            <span>Punto único de fallo</span>
                        </li>
                        <li class="flex items-start gap-2">
                            <HeroIcon IconName="arrow-right" AdditionalClass="w-4 h-4 text-red-600 flex-shrink-0 mt-1" />
                            <span>Difícil debuggear</span>
                        </li>
                        <li class="flex items-start gap-2">
                            <HeroIcon IconName="arrow-right" AdditionalClass="w-4 h-4 text-red-600 flex-shrink-0 mt-1" />
                            <span>Overhead de comunicación</span>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- ===== EJEMPLOS DE CÓDIGO ===== -->
            <div>
                <h2 class="text-2xl font-bold text-secondary-900 mb-6 flex items-center gap-2">
                    <HeroIcon IconName="code-bracket" AdditionalClass="w-6 h-6 text-primary-600" />
                    Ejemplos de Código
                </h2>

                <TabContainer TabTitles="@tabTitles" @bind-ActiveTabIndex="activeTab">
                    <!-- Tab 1: Básico -->
                    <TabPanel IsActive="activeTab == 0">
                        <div class="space-y-4">
                            <InfoBox Type="info" Title="Ejemplo Básico: Chat Room">
                                Sala de chat donde usuarios se comunican a través de mediador.
                            </InfoBox>
                            <CodeBlock Language="csharp" Code="@basicCode" />
                        </div>
                    </TabPanel>

                    <!-- Tab 2: Avanzado -->
                    <TabPanel IsActive="activeTab == 1">
                        <div class="space-y-4">
                            <InfoBox Type="tip" Title="Ejemplo Avanzado: Airport Control">
                                Control de tráfico aéreo con múltiples aeronaves.
                            </InfoBox>
                            <CodeBlock Language="csharp" Code="@advancedCode" />
                        </div>
                    </TabPanel>

                    <!-- Tab 3: Flujo -->
                    <TabPanel IsActive="activeTab == 2">
                        <div class="space-y-4">
                            <InfoBox Type="success" Title="Flujo de Comunicación">
                                Cómo se comunican los colegas a través del mediador.
                            </InfoBox>
                            <CodeBlock Language="csharp" Code="@flowCode" />
                        </div>
                    </TabPanel>
                </TabContainer>
            </div>

            <!-- ===== CASOS DE USO ===== -->
            <div class="bg-white rounded-xl shadow-md p-6 md:p-8 border-l-4 border-accent-purple">
                <h2 class="text-2xl font-bold text-secondary-900 mb-6 flex items-center gap-2">
                    <HeroIcon IconName="chart-bar" AdditionalClass="w-6 h-6 text-accent-purple" />
                    Casos de Uso Comunes
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    @foreach (var useCase in useCases)
                    {
                        <div class="flex items-start gap-3 p-3 bg-secondary-50 rounded-lg">
                            <HeroIcon IconName="check" AdditionalClass="w-5 h-5 text-accent-purple flex-shrink-0 mt-1" />
                            <span class="text-secondary-700">@useCase</span>
                        </div>
                    }
                </div>
            </div>
        </div>

        <!-- Right Column - Quick Reference -->
        <div class="space-y-6">
            <!-- Pattern Info Card -->
            <div class="bg-gradient-to-br from-primary-50 to-indigo-50 rounded-xl shadow-md p-6 border border-primary-200">
                <h3 class="text-lg font-bold text-secondary-900 mb-4">Información Rápida</h3>
                <div class="space-y-3 text-sm">
                    <div>
                        <span class="font-semibold text-secondary-700">Tipo: </span>
                        <p class="text-secondary-600">Patrón Comportamental</p>
                    </div>
                    <div>
                        <span class="font-semibold text-secondary-700">Dificultad:</span>
                        <p>
                            <span class="inline-block bg-yellow-100 text-yellow-800 px-2 py-1 rounded text-xs font-semibold">Media</span>
                        </p>
                    </div>
                    <div>
                        <span class="font-semibold text-secondary-700">Propósito:</span>
                        <p class="text-secondary-600">Centralizar comunicación</p>
                    </div>
                    <div>
                        <span class="font-semibold text-secondary-700">Frecuencia de uso:</span>
                        <p class="text-secondary-600">Alta (sistemas complejos)</p>
                    </div>
                </div>
            </div>

            <!-- Tags -->
            <div class="bg-white rounded-xl shadow-md p-6 border border-secondary-100">
                <h3 class="text-lg font-bold text-secondary-900 mb-4">Tags</h3>
                <div class="flex flex-wrap gap-2">
                    @foreach (var tag in tags)
                    {
                        <span class="bg-primary-100 text-primary-800 px-3 py-1 rounded-full text-xs font-semibold">
                            @tag
                        </span>
                    }
                </div>
            </div>

            <!-- Best Practices -->
            <div class="bg-blue-50 rounded-xl shadow-md p-6 border-l-4 border-blue-500">
                <h3 class="text-lg font-bold text-secondary-900 mb-4 flex items-center gap-2">
                    <HeroIcon IconName="star" AdditionalClass="w-5 h-5 text-blue-600" />
                    Mejores Prácticas
                </h3>
                <ul class="space-y-2 text-sm text-secondary-700">
                    <li class="flex items-start gap-2">
                        <HeroIcon IconName="check" AdditionalClass="w-4 h-4 text-blue-600 flex-shrink-0 mt-1" />
                        <span>Mantener mediador simple</span>
                    </li>
                    <li class="flex items-start gap-2">
                        <HeroIcon IconName="check" AdditionalClass="w-4 h-4 text-blue-600 flex-shrink-0 mt-1" />
                        <span>Registrar todos los colegas</span>
                    </li>
                    <li class="flex items-start gap-2">
                        <HeroIcon IconName="check" AdditionalClass="w-4 h-4 text-blue-600 flex-shrink-0 mt-1" />
                        <span>Documentar interacciones</span>
                    </li>
                    <li class="flex items-start gap-2">
                        <HeroIcon IconName="check" AdditionalClass="w-4 h-4 text-blue-600 flex-shrink-0 mt-1" />
                        <span>Considerar escalabilidad</span>
                    </li>
                </ul>
            </div>

            <!-- Related Patterns -->
            <div class="bg-white rounded-xl shadow-md p-6 border border-secondary-100">
                <h3 class="text-lg font-bold text-secondary-900 mb-4">Patrones Relacionados</h3>
                <ul class="space-y-2 text-sm">
                    <li>
                        <a href="/behavioral/observer" class="text-primary-600 hover:text-primary-800 font-semibold flex items-center gap-1">
                            <HeroIcon IconName="eye" AdditionalClass="w-4 h-4" />
                            Observer →
                        </a>
                    </li>
                    <li>
                        <a href="/behavioral/command" class="text-primary-600 hover:text-primary-800 font-semibold flex items-center gap-1">
                            <HeroIcon IconName="cog" AdditionalClass="w-4 h-4" />
                            Command →
                        </a>
                    </li>
                    <li>
                        <a href="/behavioral/chain-of-responsibility" class="text-primary-600 hover:text-primary-800 font-semibold flex items-center gap-1">
                            <HeroIcon IconName="link" AdditionalClass="w-4 h-4" />
                            Chain of Responsibility →
                        </a>
                    </li>
                </ul>
            </div>

            <!-- Communication Flow Card -->
            <div class="bg-gradient-to-r from-orange-50 to-amber-50 rounded-xl shadow-md p-6 border-l-4 border-orange-500">
                <h3 class="text-lg font-bold text-secondary-900 mb-4 flex items-center gap-2">
                    <HeroIcon IconName="arrow-left-right" AdditionalClass="w-5 h-5 text-orange-600" />
                    Flujo de Comunicación
                </h3>
                <div class="space-y-2 text-sm text-secondary-700">
                    <p>
                        <span class="font-semibold">Sin Mediator:</span><br />
                        Colega A ↔ Colega B ↔ Colega C
                    </p>
                    <p class="text-orange-600 font-bold">
                        Múltiples conexiones directas
                    </p>
                    <p>
                        <span class="font-semibold">Con Mediator:</span><br />
                        Colega A ↔ Mediator ↔ Colega B<br />
                        Colega C ↔ ⬆
                    </p>
                    <p class="text-accent-green font-bold flex items-center gap-1">
                        <HeroIcon IconName="check-circle" AdditionalClass="w-4 h-4" />
                        Comunicación centralizada
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Exercise Section -->
    <div class="bg-gradient-to-r from-accent-purple/10 to-pink-50 rounded-xl p-6 md:p-8 border border-accent-purple/30 mt-12">
        <h2 class="text-2xl font-bold text-secondary-900 mb-4 flex items-center gap-2">
            <HeroIcon IconName="academic-cap" AdditionalClass="w-6 h-6 text-accent-purple" />
            Ejercicios Prácticos
        </h2>
        <p class="text-secondary-700 mb-4">
            Ahora que entiendes Mediator, intenta implementar tu propio ejemplo:
        </p>
        <div class="space-y-3">
            <div class="flex items-start gap-3 p-3 bg-white rounded-lg border border-accent-purple/20">
                <span class="flex-shrink-0 bg-accent-purple text-white rounded-full w-6 h-6 flex items-center justify-center text-xs font-bold">1</span>
                <span class="text-secondary-700">Crea un mediador para un sistema de alertas de sensores</span>
            </div>
            <div class="flex items-start gap-3 p-3 bg-white rounded-lg border border-accent-purple/20">
                <span class="flex-shrink-0 bg-accent-purple text-white rounded-full w-6 h-6 flex items-center justify-center text-xs font-bold">2</span>
                <span class="text-secondary-700">Implementa un mediador para coordinación de tareas</span>
            </div>
            <div class="flex items-start gap-3 p-3 bg-white rounded-lg border border-accent-purple/20">
                <span class="flex-shrink-0 bg-accent-purple text-white rounded-full w-6 h-6 flex items-center justify-center text-xs font-bold">3</span>
                <span class="text-secondary-700">Crea un mediador para un sistema de trading de acciones</span>
            </div>
        </div>
    </div>
</div>

@code {
    private List<BreadcrumbItem> breadcrumbItems = new()
    {
        new BreadcrumbItem("Home", ""),
        new BreadcrumbItem("Behavioral", "behavioral"),
        new BreadcrumbItem("Mediator", "behavioral/mediator")
    };

    private int activeTab = 0;
    private List<string> tabTitles = new() { "Básico", "Avanzado", "Flujo" };

    private List<string> useCases = new()
    {
        "Salas de chat",
        "Control de tráfico aéreo",
        "Sistemas de UI con múltiples componentes",
        "Coordinación de robots",
        "Trading de bolsa",
        "Negociación de contratos",
        "Coordinación de tareas",
        "Redes de sensores"
    };

    private List<string> tags = new() { "Desacoplamiento", "Centralización", "Comunicación", "Coordinación" };

    private string basicCode = @"
    // ===== Mediator Interface =====
    public interface IChatMediator
    {
        void RegisterUser(User user);
        void SendMessage(string msg, User sender);
    }

    // ===== Colleague =====
    public abstract class User
    {
        protected IChatMediator _mediator;
        public string Name { get; protected set; }

        protected User(string name) => Name = name;

        public void SetMediator(IChatMediator m) => _mediator = m;
        public abstract void Send(string msg);
        public abstract void Receive(string msg);
    }

    // ===== Concrete Colleague =====
    public class ChatUser : User
    {
        public ChatUser(string name) : base(name) { }

        public override void Send(string msg) 
            => _mediator.SendMessage(msg, this);

        public override void Receive(string msg) 
            => Console.WriteLine($""[{Name}] {msg}"");
    }

    // ===== Concrete Mediator =====
    public class ChatRoom : IChatMediator
    {
        private List<User> _users = new();

        public void RegisterUser(User user)
        {
            _users.Add(user);
            user.SetMediator(this);
        }

        public void SendMessage(string msg, User sender)
        {
            foreach (var user in _users)
            {
                if (user != sender)
                    user.Receive($""{sender.Name}: {msg}"");
            }
        }
    }

    // ===== Uso =====
    var chat = new ChatRoom();
    var alice = new ChatUser(""Alice"");
    var bob = new ChatUser(""Bob"");

    chat.RegisterUser(alice);
    chat.RegisterUser(bob);

    alice.Send(""¡Hola Bob!"");";

    private string advancedCode = @"
    // ===== Airport Control =====
    public interface IAirportControl
    {
        void RegisterAircraft(Aircraft a);
        void RequestLanding(Aircraft a);
        void RequestTakeoff(Aircraft a);
    }

    // ===== Aircraft =====
    public abstract class Aircraft
    {
        protected IAirportControl _control;
        public string FlightNumber { get; }

        protected Aircraft(string num) => FlightNumber = num;

        public void SetControl(IAirportControl c) => _control = c;
        public abstract void RequestLanding();
        public abstract void RequestTakeoff();
        public abstract void ReceiveInstruction(string inst);
    }

    // ===== Concrete Aircraft =====
    public class Airplane : Aircraft
    {
        public Airplane(string num) : base(num) { }

        public override void RequestLanding() 
            => _control.RequestLanding(this);

        public override void RequestTakeoff() 
            => _control.RequestTakeoff(this);

        public override void ReceiveInstruction(string inst) 
            => Console.WriteLine($""[AIRCRAFT {FlightNumber}] {inst}"");
    }

    // ===== AirportControl =====
    public class AirportControl : IAirportControl
    {
        private List<Aircraft> _aircrafts = new();
        private bool _runwayFree = true;

        public void RegisterAircraft(Aircraft a)
        {
            _aircrafts.Add(a);
            a.SetControl(this);
        }

        public void RequestLanding(Aircraft a)
        {
            if (_runwayFree)
            {
                _runwayFree = false;
                a.ReceiveInstruction(""AUTORIZADO aterrizaje"");
                _runwayFree = true;
            }
            else
                a.ReceiveInstruction(""ESPERE en órbita"");
        }

        public void RequestTakeoff(Aircraft a)
        {
            if (_runwayFree)
            {
                _runwayFree = false;
                a.ReceiveInstruction(""AUTORIZADO despegue"");
                _runwayFree = true;
            }
        }
    }";

    private string flowCode = @"
    // ===== SIN MEDIATOR (Acoplamiento alto) =====
    usuario1.EnviarA(usuario2, ""Hola"");
    usuario1.EnviarA(usuario3, ""Hola"");
    usuario2.EnviarA(usuario1, ""Hola"");
    usuario2.EnviarA(usuario3, ""Hola"");
    usuario3.EnviarA(usuario1, ""Hola"");
    usuario3.EnviarA(usuario2, ""Hola"");

    // N usuarios = N(N-1) conexiones directas
    // ❌ Altamente acoplado

    // ===== CON MEDIATOR (Desacoplamiento) =====
    usuario1.Send(""Hola"");
    usuario2.Send(""Hola"");
    usuario3.Send(""Hola"");

    // Mediator distribuye mensajes
    // ✅ Bajo acoplamiento
    // ✅ Lógica centralizada

    // ===== FLUJO =====
    usuario1.Send(msg)
        ↓
    mediator.SendMessage(msg, usuario1)
        ↓
    for each usuario in usuarios
        if usuario != usuario1
            usuario.Receive(msg)";
}