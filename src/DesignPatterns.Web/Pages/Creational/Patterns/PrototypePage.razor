@page "/creational/prototype"

<PageTitle>Prototype Pattern - Design Patterns</PageTitle>

<div class="max-w-7xl mx-auto px-4 py-8 md:py-12">
    <!-- Breadcrumb -->
    <Breadcrumb Items="@breadcrumbItems" />

    <!-- Header -->
    <div class="mb-12">
        <div class="flex items-center gap-3 md:gap-4 mb-4">
            <HeroIcon IconName="document-duplicate" AdditionalClass="w-10 h-10 text-primary-600" />
            <div>
                <h1 class="text-4xl md:text-5xl font-bold text-secondary-900">Prototype Pattern</h1>
                <p class="text-secondary-600 text-lg mt-2">Patrón Creacional</p>
            </div>
        </div>
        <p class="text-secondary-600 text-base md:text-lg max-w-3xl">
            Prototype define una interfaz para crear un objeto clonando un prototipo existente.
            Permite crear nuevas instancias basadas en un original, evitando la necesidad de crear desde cero
            y siendo especialmente útil para objetos complejos.
        </p>
    </div>

    <!-- Main Content Grid -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-12">
        <!-- Left Column - Conceptual Content -->
        <div class="lg:col-span-2 space-y-8">
            <!-- ===== DEFINICIÓN ===== -->
            <div class="bg-white rounded-xl shadow-md p-6 md:p-8 border-l-4 border-primary-600">
                <div class="flex items-start gap-4 mb-4">
                    <HeroIcon IconName="light-bulb" AdditionalClass="w-6 h-6 text-primary-600 flex-shrink-0 mt-1" />
                    <div class="flex-1">
                        <h2 class="text-2xl font-bold text-secondary-900 mb-3">¿Qué es Prototype?</h2>
                        <p class="text-secondary-700 leading-relaxed">
                            Prototype es un patrón de diseño creacional que permite crear nuevos objetos
                            clonando un prototipo existente en lugar de crearlos desde cero. Es especialmente
                            útil cuando la creación de un objeto es costosa o compleja.
                        </p>
                    </div>
                </div>
            </div>

            <!-- ===== VENTAJAS Y DESVENTAJAS ===== -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Ventajas -->
                <div class="bg-green-50 rounded-xl shadow-md p-6 border-l-4 border-accent-green">
                    <div class="flex items-center gap-2 mb-4">
                        <HeroIcon IconName="check-circle" AdditionalClass="w-6 h-6 text-accent-green" />
                        <h3 class="text-xl font-bold text-secondary-900">Ventajas</h3>
                    </div>
                    <ul class="space-y-2 text-secondary-700">
                        <li class="flex items-start gap-2">
                            <HeroIcon IconName="arrow-right" AdditionalClass="w-4 h-4 text-accent-green flex-shrink-0 mt-1" />
                            <span>Evita jerarquías de clases complejas</span>
                        </li>
                        <li class="flex items-start gap-2">
                            <HeroIcon IconName="arrow-right" AdditionalClass="w-4 h-4 text-accent-green flex-shrink-0 mt-1" />
                            <span>Clonación más eficiente que crear desde cero</span>
                        </li>
                        <li class="flex items-start gap-2">
                            <HeroIcon IconName="arrow-right" AdditionalClass="w-4 h-4 text-accent-green flex-shrink-0 mt-1" />
                            <span>Flexible para crear variaciones</span>
                        </li>
                        <li class="flex items-start gap-2">
                            <HeroIcon IconName="arrow-right" AdditionalClass="w-4 h-4 text-accent-green flex-shrink-0 mt-1" />
                            <span>Reduce acoplamiento entre clases</span>
                        </li>
                    </ul>
                </div>

                <!-- Desventajas -->
                <div class="bg-red-50 rounded-xl shadow-md p-6 border-l-4 border-red-500">
                    <div class="flex items-center gap-2 mb-4">
                        <HeroIcon IconName="exclamation-circle" AdditionalClass="w-6 h-6 text-red-600" />
                        <h3 class="text-xl font-bold text-secondary-900">Desventajas</h3>
                    </div>
                    <ul class="space-y-2 text-secondary-700">
                        <li class="flex items-start gap-2">
                            <HeroIcon IconName="arrow-right" AdditionalClass="w-4 h-4 text-red-600 flex-shrink-0 mt-1" />
                            <span>Clonación profunda puede ser compleja</span>
                        </li>
                        <li class="flex items-start gap-2">
                            <HeroIcon IconName="arrow-right" AdditionalClass="w-4 h-4 text-red-600 flex-shrink-0 mt-1" />
                            <span>Objetos circulares son difíciles de clonar</span>
                        </li>
                        <li class="flex items-start gap-2">
                            <HeroIcon IconName="arrow-right" AdditionalClass="w-4 h-4 text-red-600 flex-shrink-0 mt-1" />
                            <span>Puede ser más lento que instanciación directa</span>
                        </li>
                        <li class="flex items-start gap-2">
                            <HeroIcon IconName="arrow-right" AdditionalClass="w-4 h-4 text-red-600 flex-shrink-0 mt-1" />
                            <span>Requiere implementar ICloneable correctamente</span>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- ===== EJEMPLOS DE CÓDIGO ===== -->
            <div>
                <h2 class="text-2xl font-bold text-secondary-900 mb-6 flex items-center gap-2">
                    <HeroIcon IconName="code-bracket" AdditionalClass="w-6 h-6 text-primary-600" />
                    Ejemplos de Código
                </h2>

                <TabContainer TabTitles="@tabTitles" @bind-ActiveTabIndex="activeTab">
                    <!-- Tab 1: Básico -->
                    <TabPanel IsActive="activeTab == 0">
                        <div class="space-y-4">
                            <InfoBox Type="info" Title="Ejemplo Básico: Document Cloning">
                                Clonar documentos de forma simple manteniendo el original intacto.
                            </InfoBox>
                            <CodeBlock Language="csharp" Code="@basicCode" />
                        </div>
                    </TabPanel>

                    <!-- Tab 2: Avanzado -->
                    <TabPanel IsActive="activeTab == 1">
                        <div class="space-y-4">
                            <InfoBox Type="tip" Title="Ejemplo Avanzado: Game Character Cloning">
                                Clonar personajes de juego complejos con clonación profunda de sus atributos.
                            </InfoBox>
                            <CodeBlock Language="csharp" Code="@advancedCode" />
                        </div>
                    </TabPanel>

                    <!-- Tab 3: Uso -->
                    <TabPanel IsActive="activeTab == 2">
                        <div class="space-y-4">
                            <InfoBox Type="success" Title="Cómo Usar Prototype">
                                Ejemplo de cómo el cliente clona objetos y crea variantes.
                            </InfoBox>
                            <CodeBlock Language="csharp" Code="@usageCode" />
                        </div>
                    </TabPanel>
                </TabContainer>
            </div>

            <!-- ===== CASOS DE USO ===== -->
            <div class="bg-white rounded-xl shadow-md p-6 md:p-8 border-l-4 border-accent-purple">
                <h2 class="text-2xl font-bold text-secondary-900 mb-6 flex items-center gap-2">
                    <HeroIcon IconName="chart-bar" AdditionalClass="w-6 h-6 text-accent-purple" />
                    Casos de Uso Comunes
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    @foreach (var useCase in useCases)
                    {
                        <div class="flex items-start gap-3 p-3 bg-secondary-50 rounded-lg">
                            <HeroIcon IconName="check" AdditionalClass="w-5 h-5 text-accent-purple flex-shrink-0 mt-1" />
                            <span class="text-secondary-700">@useCase</span>
                        </div>
                    }
                </div>
            </div>
        </div>

        <!-- Right Column - Quick Reference -->
        <div class="space-y-6">
            <!-- Pattern Info Card -->
            <div class="bg-gradient-to-br from-primary-50 to-indigo-50 rounded-xl shadow-md p-6 border border-primary-200">
                <h3 class="text-lg font-bold text-secondary-900 mb-4">Información Rápida</h3>
                <div class="space-y-3 text-sm">
                    <div>
                        <span class="font-semibold text-secondary-700">Tipo: </span>
                        <p class="text-secondary-600">Patrón Creacional</p>
                    </div>
                    <div>
                        <span class="font-semibold text-secondary-700">Dificultad:</span>
                        <p>
                            <span class="inline-block bg-yellow-100 text-yellow-800 px-2 py-1 rounded text-xs font-semibold">Media</span>
                        </p>
                    </div>
                    <div>
                        <span class="font-semibold text-secondary-700">Propósito:</span>
                        <p class="text-secondary-600">Crear objetos clonando un prototipo</p>
                    </div>
                    <div>
                        <span class="font-semibold text-secondary-700">Frecuencia de uso:</span>
                        <p class="text-secondary-600">Media-Alta (gaming, documentos)</p>
                    </div>
                </div>
            </div>

            <!-- Tags -->
            <div class="bg-white rounded-xl shadow-md p-6 border border-secondary-100">
                <h3 class="text-lg font-bold text-secondary-900 mb-4">Tags</h3>
                <div class="flex flex-wrap gap-2">
                    @foreach (var tag in tags)
                    {
                        <span class="bg-primary-100 text-primary-800 px-3 py-1 rounded-full text-xs font-semibold">
                            @tag
                        </span>
                    }
                </div>
            </div>

            <!-- Best Practices -->
            <div class="bg-blue-50 rounded-xl shadow-md p-6 border-l-4 border-blue-500">
                <h3 class="text-lg font-bold text-secondary-900 mb-4 flex items-center gap-2">
                    <HeroIcon IconName="star" AdditionalClass="w-5 h-5 text-blue-600" />
                    Mejores Prácticas
                </h3>
                <ul class="space-y-2 text-sm text-secondary-700">
                    <li class="flex items-start gap-2">
                        <HeroIcon IconName="check" AdditionalClass="w-4 h-4 text-blue-600 flex-shrink-0 mt-1" />
                        <span>Implementar clonación profunda correctamente</span>
                    </li>
                    <li class="flex items-start gap-2">
                        <HeroIcon IconName="check" AdditionalClass="w-4 h-4 text-blue-600 flex-shrink-0 mt-1" />
                        <span>Usar PrototypeRegistry para gestionar prototipos</span>
                    </li>
                    <li class="flex items-start gap-2">
                        <HeroIcon IconName="check" AdditionalClass="w-4 h-4 text-blue-600 flex-shrink-0 mt-1" />
                        <span>Documentar qué se clona (profundo vs superficial)</span>
                    </li>
                    <li class="flex items-start gap-2">
                        <HeroIcon IconName="check" AdditionalClass="w-4 h-4 text-blue-600 flex-shrink-0 mt-1" />
                        <span>Evitar referencias circulares en clones</span>
                    </li>
                </ul>
            </div>

            <!-- Related Patterns -->
            <div class="bg-white rounded-xl shadow-md p-6 border border-secondary-100">
                <h3 class="text-lg font-bold text-secondary-900 mb-4">Patrones Relacionados</h3>
                <ul class="space-y-2 text-sm">
                    <li>
                        <a href="/creational/singleton" class="text-primary-600 hover:text-primary-800 font-semibold flex items-center gap-1">
                            <HeroIcon IconName="lock-closed" AdditionalClass="w-4 h-4" />
                            Singleton →
                        </a>
                    </li>
                    <li>
                        <a href="/creational/factory" class="text-primary-600 hover:text-primary-800 font-semibold flex items-center gap-1">
                            <HeroIcon IconName="building-library" AdditionalClass="w-4 h-4" />
                            Factory Method →
                        </a>
                    </li>
                    <li>
                        <a href="/creational/builder" class="text-primary-600 hover:text-primary-800 font-semibold flex items-center gap-1">
                            <HeroIcon IconName="wrench-screwdriver" AdditionalClass="w-4 h-4" />
                            Builder →
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Exercise Section -->
    <div class="bg-gradient-to-r from-accent-purple/10 to-pink-50 rounded-xl p-6 md:p-8 border border-accent-purple/30 mt-12">
        <h2 class="text-2xl font-bold text-secondary-900 mb-4 flex items-center gap-2">
            <HeroIcon IconName="academic-cap" AdditionalClass="w-6 h-6 text-accent-purple" />
            Ejercicios Prácticos
        </h2>
        <p class="text-secondary-700 mb-4">
            Ahora que entiendes Prototype, intenta implementar tu propio ejemplo:
        </p>
        <div class="space-y-3">
            <div class="flex items-start gap-3 p-3 bg-white rounded-lg border border-accent-purple/20">
                <span class="flex-shrink-0 bg-accent-purple text-white rounded-full w-6 h-6 flex items-center justify-center text-xs font-bold">1</span>
                <span class="text-secondary-700">Crea un prototipo de configuración de usuario y clónalo con valores diferentes</span>
            </div>
            <div class="flex items-start gap-3 p-3 bg-white rounded-lg border border-accent-purple/20">
                <span class="flex-shrink-0 bg-accent-purple text-white rounded-full w-6 h-6 flex items-center justify-center text-xs font-bold">2</span>
                <span class="text-secondary-700">Implementa clonación profunda para objetos con colecciones anidadas</span>
            </div>
            <div class="flex items-start gap-3 p-3 bg-white rounded-lg border border-accent-purple/20">
                <span class="flex-shrink-0 bg-accent-purple text-white rounded-full w-6 h-6 flex items-center justify-center text-xs font-bold">3</span>
                <span class="text-secondary-700">Crea un PrototypeRegistry para gestionar múltiples plantillas de objetos</span>
            </div>
        </div>
    </div>
</div>

@code {
    private List<BreadcrumbItem> breadcrumbItems = new()
    {
        new BreadcrumbItem("Home", ""),
        new BreadcrumbItem("Creational", "creational"),
        new BreadcrumbItem("Prototype", "creational/prototype")
    };

    private int activeTab = 0;
    private List<string> tabTitles = new() { "Básico", "Avanzado", "Uso" };

    private List<string> useCases = new()
    {
        "Clonación de documentos",
        "Creación de variantes de personajes en juegos",
        "Copia de configuraciones complejas",
        "Duplicación de objetos de base de datos",
        "Creación rápida de plantillas",
        "Copias de objetos con estado",
        "Historial de versiones (undo/redo)",
        "Creación de variantes de entidades"
    };

    private List<string> tags = new() { "Clonación", "Deep Copy", "Variantes", "Eficiencia" };

    private string basicCode = @"
    // ===== Interfaz Prototype =====
    public interface IPrototype
    {
        IPrototype Clone();
    }

    // ===== Documento =====
    public class Document : IPrototype
    {
        public string Title { get; set; }
        public string Content { get; set; }
        public string Author { get; set; }

        public IPrototype Clone()
        {
            return new Document
            {
                Title = this.Title,
                Content = this.Content,
                Author = this.Author
            };
        }
    }

    // ===== Uso =====
    var original = new Document
    {
        Title = ""Propuesta"",
        Content = ""Contenido..."",
        Author = ""Juan""
    };

    var cloned = original.Clone() as Document;
    cloned.Title = ""Propuesta v2"";

    // original.Title sigue siendo ""Propuesta""
    // cloned.Title es ""Propuesta v2""";

    private string advancedCode = @"
    // ===== Atributo =====
    public class CharacterAttribute
    {
        public string Name { get; set; }
        public int Value { get; set; }

        public CharacterAttribute Clone()
        {
            return new CharacterAttribute { Name = Name, Value = Value };
        }
    }

    // ===== Personaje con clonación profunda =====
    public class GameCharacter : IPrototype
    {
        public string Name { get; set; }
        public List<CharacterAttribute> Attributes { get; set; }

        public IPrototype Clone()
        {
            // Clone profundo: clonar también los atributos
            var cloned = new GameCharacter
            {
                Name = this.Name,
                Attributes = new()
            };

            foreach (var attr in Attributes)
            {
                cloned.Attributes.Add(attr.Clone());
            }

            return cloned;
        }
    }

    // ===== Uso =====
    var hero = new GameCharacter
    {
        Name = ""Guerrero"",
        Attributes = new()
    };
    hero.Attributes.Add(new CharacterAttribute { Name = ""Fuerza"", Value = 10 });

    var archer = hero.Clone() as GameCharacter;
    archer.Name = ""Arquero"";
    archer.Attributes[0].Value = 8;

    // hero.Attributes[0].Value sigue siendo 10
    // archer.Attributes[0].Value es 8";

    private string usageCode = @"
    // ===== Crear prototipo base =====
    var baseCharacter = new GameCharacter { Name = ""Base"" };
    baseCharacter.AddAttribute(""Fuerza"", 10);
    baseCharacter.AddAttribute(""Defensa"", 5);

    // ===== Crear variante de guerrero =====
    var warrior = baseCharacter.Clone() as GameCharacter;
    warrior.Name = ""Guerrero"";
    warrior.Attributes[0].Value = 15; // Más fuerza

    // ===== Crear variante de mago =====
    var mage = baseCharacter.Clone() as GameCharacter;
    mage.Name = ""Mago"";
    mage.Attributes[1].Value = 3;  // Menos defensa

    // ===== Usar registry =====
    var registry = new PrototypeRegistry();
    registry.Register(""base"", baseCharacter);

    var newCharacter = registry.GetClone(""base"") as GameCharacter;
    newCharacter.Name = ""Nuevo Personaje"";

    // Cada clon es independiente
    // Cambios no afectan el prototipo original";
}